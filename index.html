<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Flappy Bird – With High Score</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: #71c5cf;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: Arial, Helvetica, sans-serif;
    overflow: hidden;
  }
  #game {
    background: #ded895;
    border: 8px solid #5e7c3c;
    box-shadow: 0 0 30px #0008;
  }
  #ui {
    position: absolute;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-weight: bold;
    text-shadow: 3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    pointer-events: none;
  }
  #score {
    font-size: 48px;
    line-height: 1;
  }
  #highscore {
    font-size: 28px;
    opacity: 0.9;
  }
  #start-screen, #game-over {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    background: rgba(0,0,0,0.5);
    font-size: 38px;
    text-align: center;
    text-shadow: 2px 2px 6px #000;
    gap: 15px;
    cursor: pointer;
  }
  #start-screen > div:first-child,
  #game-over > div:first-child {
    font-size: 48px;
    font-weight: bold;
  }
  .score-line {
    font-size: 32px;
    margin: 5px 0;
  }
  #start-screen span,
  #game-over span {
    font-size: 22px;
    margin-top: 10px;
  }
</style>
</head>
<body>

<div id="ui">
  <div id="score">0</div>
  <div id="highscore">0</div>
</div>

<canvas id="game" width="320" height="480"></canvas>

<div id="start-screen">
  <div>Flappy Bird</div>
  <div class="score-line">Best: <span id="start-best">0</span></div>
  <span>Click / Space / Tap to start</span>
</div>

<div id="game-over" style="display:none">
  <div>Game Over</div>
  <div class="score-line">Score: <span id="final-score">0</span></div>
  <div class="score-line">Best: <span id="final-best">0</span></div>
  <span>Click / Space / Tap to restart</span>
</div>

<script>
// ────────────────────────────────────────────────
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const highscoreEl = document.getElementById('highscore');
const startBestEl = document.getElementById('start-best');
const finalScoreEl = document.getElementById('final-score');
const finalBestEl = document.getElementById('final-best');
const startScreen = document.getElementById('start-screen');
const gameOverScreen = document.getElementById('game-over');

let bird = { x: 80, y: 200, vy: 0, radius: 12, gravity: 0.45, jump: -8.2 };
let pipes = [];
let score = 0;
let highScore = parseInt(localStorage.getItem('flappyHighScore') || '0');
let gameRunning = false;
let frame = 0;

function resetGame() {
  bird.y = 200;
  bird.vy = 0;
  pipes = [];
  score = 0;
  scoreEl.textContent = '0';
  finalScoreEl.textContent = '0';
  startBestEl.textContent = highScore;
  finalBestEl.textContent = highScore;
  gameRunning = false;
  startScreen.style.display = 'flex';
  gameOverScreen.style.display = 'none';
}

function spawnPipe() {
  const gap = 130;
  const minHeight = 60;
  const maxHeight = canvas.height - gap - minHeight;
  const top = minHeight + Math.random() * (maxHeight - minHeight);
  
  pipes.push({
    x: canvas.width,
    topHeight: top,
    bottomY: top + gap,
    width: 60,
    scored: false
  });
}

function endGame() {
  gameRunning = false;
  gameOverScreen.style.display = 'flex';
  finalScoreEl.textContent = score;
  finalBestEl.textContent = highScore;
}

function update() {
  if (!gameRunning) return;

  // Bird physics
  bird.vy += bird.gravity;
  bird.y += bird.vy;

  // Ground & ceiling collision
  if (bird.y + bird.radius > canvas.height || bird.y - bird.radius < 0) {
    endGame();
    return;
  }

  // Pipes
  if (frame % 90 === 0) spawnPipe();

  for (let i = pipes.length - 1; i >= 0; i--) {
    const p = pipes[i];
    p.x -= 1.8;

    // Collision
    if (
      bird.x + bird.radius > p.x &&
      bird.x - bird.radius < p.x + p.width &&
      (bird.y - bird.radius < p.topHeight || bird.y + bird.radius > p.bottomY)
    ) {
      endGame();
      return;
    }

    // Score
    if (!p.scored && p.x + p.width < bird.x) {
      p.scored = true;
      score++;
      scoreEl.textContent = score;
      if (score > highScore) {
        highScore = score;
        highscoreEl.textContent = highScore;
        startBestEl.textContent = highScore;
        finalBestEl.textContent = highScore;
        localStorage.setItem('flappyHighScore', highScore);
      }
      return;
    }

    // Remove off-screen pipes
    if (p.x + p.width < -10) {
      pipes.splice(i, 1);
    }
  }

  frame++;
}

function draw() {
  // Sky
  ctx.fillStyle = "#71c5cf";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Ground
  ctx.fillStyle = "#5e7c3c";
  ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

  // Bird (simple yellow circle + beak + eye)
  ctx.fillStyle = "#ffde00";
  ctx.beginPath();
  ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI*2);
  ctx.fill();

  // Beak
  ctx.fillStyle = "#ff8800";
  ctx.beginPath();
  ctx.moveTo(bird.x + bird.radius, bird.y);
  ctx.lineTo(bird.x + bird.radius + 12, bird.y - 6);
  ctx.lineTo(bird.x + bird.radius + 12, bird.y + 6);
  ctx.fill();

  // Eye
  ctx.fillStyle = "white";
  ctx.beginPath();
  ctx.arc(bird.x + 5, bird.y - 4, 5, 0, Math.PI*2);
  ctx.fill();
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.arc(bird.x + 7, bird.y - 4, 3, 0, Math.PI*2);
  ctx.fill();

  // Pipes
  ctx.fillStyle = "#569454";
  for (const p of pipes) {
    // Top pipe
    ctx.fillRect(p.x, 0, p.width, p.topHeight);
    // Bottom pipe
    ctx.fillRect(p.x, p.bottomY, p.width, canvas.height - p.bottomY);
    
    // Pipe borders (darker green)
    ctx.fillStyle = "#3e6a3b";
    ctx.fillRect(p.x, p.topHeight-20, p.width, 20);           // top rim
    ctx.fillRect(p.x, p.bottomY, p.width, 20);                // bottom rim
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

// Controls
function flap() {
  if (!gameRunning) {
    if (startScreen.style.display !== 'none') {
      startScreen.style.display = 'none';
      gameRunning = true;
      spawnPipe(); // first pipe
    } else if (gameOverScreen.style.display !== 'none') {
      resetGame();
    }
  }
  if (gameRunning) {
    bird.vy = bird.jump;
  }
}

window.addEventListener('keydown', e => {
  if (e.code === 'Space' || e.code === 'ArrowUp') {
    e.preventDefault();
    flap();
  }
});

canvas.addEventListener('click', flap);
canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  flap();
});

// Start
highscoreEl.textContent = highScore;
startBestEl.textContent = highScore;
finalBestEl.textContent = highScore;
resetGame();
gameLoop();

</script>
</body>
</html>
